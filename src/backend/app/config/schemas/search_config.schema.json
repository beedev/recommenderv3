{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Search Configuration Schema",
  "description": "Schema for search_config.json - defines search and product matching configuration",
  "type": "object",
  "required": [
    "version",
    "description",
    "fuzzy_matching",
    "fallback_behavior",
    "search_ranking",
    "compatibility_checking",
    "performance",
    "strategies",
    "orchestration",
    "consolidation"
  ],
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+$",
      "description": "Version number (e.g., 1.0)"
    },
    "description": {
      "type": "string",
      "description": "Overall description of search configuration"
    },
    "last_updated": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
      "description": "Last update date in YYYY-MM-DD format"
    },
    "fuzzy_matching": {
      "type": "object",
      "required": ["enabled", "score_cutoff", "max_matches", "algorithm", "description"],
      "properties": {
        "enabled": {"type": "boolean"},
        "score_cutoff": {"type": "integer", "minimum": 0, "maximum": 100},
        "max_matches": {"type": "integer", "minimum": 1},
        "algorithm": {"type": "string", "enum": ["fuzz.ratio", "fuzz.partial_ratio", "fuzz.token_sort_ratio"]},
        "description": {"type": "string"}
      },
      "additionalProperties": false,
      "description": "Component-specific enabled flags (fuzzy_matching_enabled) now loaded from component_types.json. Rationalized Nov 15, 2024."
    },
    "fallback_behavior": {
      "type": "object",
      "required": ["enabled", "show_all_compatible_if_no_match", "log_fallback_events", "description"],
      "properties": {
        "enabled": {"type": "boolean"},
        "show_all_compatible_if_no_match": {"type": "boolean"},
        "log_fallback_events": {"type": "boolean"},
        "description": {"type": "string"}
      },
      "additionalProperties": false
    },
    "search_ranking": {
      "type": "object",
      "required": ["use_ranking", "rank_by_relevance", "prefer_exact_matches", "description"],
      "properties": {
        "use_ranking": {"type": "boolean"},
        "rank_by_relevance": {"type": "boolean"},
        "prefer_exact_matches": {"type": "boolean"},
        "description": {"type": "string"}
      },
      "additionalProperties": false
    },
    "compatibility_checking": {
      "type": "object",
      "required": ["enabled", "check_power_source_compatibility", "check_feeder_compatibility", "strict_mode", "description"],
      "properties": {
        "enabled": {"type": "boolean"},
        "check_power_source_compatibility": {"type": "boolean"},
        "check_feeder_compatibility": {"type": "boolean"},
        "strict_mode": {"type": "boolean"},
        "description": {"type": "string"}
      },
      "additionalProperties": false
    },
    "performance": {
      "type": "object",
      "required": ["cache_search_results", "cache_ttl_seconds", "max_cache_entries", "description"],
      "properties": {
        "cache_search_results": {"type": "boolean"},
        "cache_ttl_seconds": {"type": "integer", "minimum": 0},
        "max_cache_entries": {"type": "integer", "minimum": 1},
        "description": {"type": "string"}
      },
      "additionalProperties": false
    },
    "strategies": {
      "type": "object",
      "required": ["description", "cypher", "lucene"],
      "properties": {
        "description": {"type": "string"},
        "cypher": {
          "type": "object",
          "required": ["enabled", "weight", "description", "fallback_on_error", "timeout_seconds"],
          "properties": {
            "enabled": {"type": "boolean"},
            "weight": {"type": "number", "minimum": 0, "maximum": 1},
            "description": {"type": "string"},
            "fallback_on_error": {"type": "boolean"},
            "timeout_seconds": {"type": "integer", "minimum": 1},
            "max_priority": {"type": "integer"},
            "min_score": {"type": "number"},
            "default_priority": {"type": "integer"}
          },
          "additionalProperties": false
        },
        "lucene": {
          "type": "object",
          "required": ["enabled", "weight", "min_score", "score_threshold_percent", "append_score_to_name", "score_decimal_places", "limit", "description", "fallback_on_error", "timeout_seconds"],
          "properties": {
            "enabled": {"type": "boolean"},
            "weight": {"type": "number", "minimum": 0, "maximum": 1},
            "min_score": {"type": "number", "minimum": 0, "maximum": 1},
            "score_threshold_percent": {"type": "integer", "minimum": 0, "maximum": 100},
            "append_score_to_name": {"type": "boolean"},
            "score_decimal_places": {"type": "integer", "minimum": 0, "maximum": 3},
            "limit": {"type": "integer", "minimum": 1},
            "description": {"type": "string"},
            "fallback_on_error": {"type": "boolean"},
            "timeout_seconds": {"type": "integer", "minimum": 1}
          },
          "additionalProperties": false,
          "description": "Component-specific scoring (lucene_min_score, lucene_score_threshold_percent) now loaded from component_types.json. Rationalized Nov 15, 2024."
        }
      },
      "additionalProperties": false
    },
    "orchestration": {
      "type": "object",
      "required": ["description", "execution_mode", "timeout_seconds", "fallback_strategy", "zero_results_behavior", "max_concurrent_strategies"],
      "properties": {
        "description": {"type": "string"},
        "execution_mode": {"type": "string", "enum": ["parallel", "sequential"]},
        "timeout_seconds": {"type": "integer", "minimum": 1},
        "fallback_strategy": {"type": "string", "enum": ["cypher", "lucene"]},
        "zero_results_behavior": {"type": "string"},
        "max_concurrent_strategies": {"type": "integer", "minimum": 1},
        "notes": {"type": "string"}
      },
      "additionalProperties": false
    },
    "consolidation": {
      "type": "object",
      "required": ["description", "deduplication_strategy", "score_normalization", "apply_normalization", "default_score"],
      "properties": {
        "description": {"type": "string"},
        "deduplication_strategy": {"type": "string", "enum": ["first_occurrence", "highest_score"]},
        "score_normalization": {"type": "string", "enum": ["min_max", "z_score", "none"]},
        "apply_normalization": {"type": "boolean"},
        "default_score": {"type": "number", "minimum": 0, "maximum": 1},
        "notes": {"type": "string"}
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
